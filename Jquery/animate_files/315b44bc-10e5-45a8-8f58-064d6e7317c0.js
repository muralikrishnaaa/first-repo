(()=>{let e;function o(e,o,r,t){Object.defineProperty(e,o,{get:r,set:t,enumerable:!0,configurable:!0})}var r,t,i,n,d,a,_,l,s={};o(s,"Template",()=>a),o(s,"ErrorCode",()=>_),o(s,"errorDict",()=>k),o(s,"deepCopy",()=>H),o(s,"triggerPmac",()=>eE),o(s,"initPubxGlobals",()=>eR),o(s,"arePubxFloorsSkipped",()=>eU),o(s,"arePubxFloorsSet",()=>eA),o(s,"getFloorMvValue",()=>eF),o(s,"getPubxOptimizedValue",()=>eT),o(s,"getPubxSplitValue",()=>eC),o(s,"setSplitKeyGlobal",()=>ew),o(s,"setFloorsAndMvInGlobal",()=>ev);let u="PubxFloorProvider";(r=d||(d={})).WIN="WIN",r.FLOORED="FLOORED",r.NOBIDS="NOBIDS";let O=()=>(()=>({splitRate:95,samplingRate:370,pbNsKeys:"pbjs,snpbjs",pbNamespaces:[],currency:"EUR",modelVersion:"cb_AB_z_dt_0.75_dwt_1.0_dnt_0.1",auctionDelay:100,pubxId:"315b44bc-10e5-45a8-8f58-064d6e7317c0",schema:['gptSlot','mediaType'],defaultValues:{'*|banner':0.01},floorFetchUrl:"https://floor.pbxai.com/?pubxId=315b44bc-10e5-45a8-8f58-064d6e7317c0&page="+window.location.href,floorMin:null,hbPbKey:"hb_pb",pubxSplitKey:"pubx-a",pubxSplitOnValue:"on",pubxSplitOffValue:"off",pubxOptimizedKey:"pubx-op",pubxOptimizedOnValue:"on",pubxOptimizedOffValue:"off",pubxMvKey:"pubx-m_v",pubxFloorKey:"pubx-floor",pubxFloorMvKey:"pubx-floor-mv"}))(),c=e=>{e.pbNamespaces=e.pbNsKeys.split(",").map(e=>(window[e]=window[e]||{},window[e].que=window[e].que||[],window[e].name=e,window[e]))},p=e=>({provider:"pubxai",options:{samplingRate:e.samplingRate,pubxId:e.pubxId}}),f=(e,o,r)=>{e&&o.pbNamespaces.forEach(e=>{e.que.push(function(){let{debug:t,error:i,remotePageError:n}=window.__pubx__.logger;if(!e.installedModules.includes("priceFloors")){i("priceFloors module is not installed"),n({code:s.ErrorCode.PRICE_FLOORS_NOT_FOUND});return}let d=e.getConfig("floors");d&&d.data&&d.data.floorProvider!==u&&(i("Non-pubx floor provider present",d),n({code:s.ErrorCode.NON_PUBX_FLOORS_FOUND,payload:{existingFloors:d}}));let a=r(o);window.__pubxFloorsConfig__=a,e.setConfig(a),t("Setting Floors Config",(0,s.deepCopy)(a))})})},g=(e,o)=>{let r=void 0!==e.adserverTargeting&&void 0!==e.adserverTargeting[o]&&!isNaN(e.adserverTargeting[o])&&parseFloat(e.adserverTargeting[o])>0;return r},N=(e,o)=>e.filter(e=>e.adUnitCode===o),b=(e,o)=>e.filter(e=>e.adUnitCode===o),E=(e,o)=>e.flatMap(e=>e.bids).filter(e=>e.adUnitCode===o),R=(e,o,r)=>0===e.length&&0===o.length?d.NOBIDS:e.some(e=>g(e,r))?d.WIN:d.FLOORED,m=(e,o,r,t,i,n)=>o===r?e:"number"!=typeof e||"string"!=typeof o||"string"!=typeof r?(i({code:s.ErrorCode.CURRENCY_INVALID_INPUT,adUnitCode:t,payload:{value:e,fromCurrency:o,toCurrency:r}}),window.__pubx__.logger.error("Invalid input types for currency conversion",{value:e,fromCurrency:o,toCurrency:r},"Skipping conversion."),e):void 0===n.convertCurrency?(i({code:s.ErrorCode.CURRENCY_MODULE_NOT_INSTALLED,adUnitCode:t,payload:{value:e,fromCurrency:o,toCurrency:r}}),window.__pubx__.logger.error("Currency module is not configured in prebid.js. Skipping conversion."),e):n.convertCurrency(e,o,r),U=(e,o)=>[...e,...o],A=e=>{if(void 0!==e)return{floorValue:e.floorValue,floorRule:e.floorRule,floorCurrency:e.floorCurrency}},I=(e,o,r,t,i,n,a,_)=>{let l,u,O,c,p,f;let{remoteAucError:N,remoteAucEvent:b}=a,{hbPbKey:E}=n;switch(i){case d.WIN:let R=o.filter(e=>g(e,E)).sort((e,o)=>parseFloat(o.adserverTargeting[E])-parseFloat(e.adserverTargeting[E]))[0];l=parseFloat(R.adserverTargeting[E]),u=R.currency,O=R.floorData,c=R.adserverTargeting;break;case d.FLOORED:let I=U(r,o),F=I.sort((o,r)=>m(r.originalCpm,r.originalCurrency,n.currency,e.code,N,_)-m(o.originalCpm,o.originalCurrency,n.currency,e.code,N,_))[0];l=F.originalCpm,u=F.originalCurrency,O=F.floorData,c=F.adserverTargeting;break;case d.NOBIDS:if(u=n.currency,(0,s.arePubxFloorsSkipped)(e)){l=.01;break}void 0!==e.sizes?p=e.sizes:(N({code:s.ErrorCode.ADUNIT_SIZES_NOT_FOUND,adUnitCode:e.code}),window.__pubx__.logger.error("sizes in adUnit is undefined",e),p=["*"]);let T=t.flatMap(o=>p.map(r=>{if("function"==typeof o.getFloor){let t=o.getFloor({size:r,mediaType:"banner"});if(void 0!==t&&void 0!==t.floor)return t.floor;window.__pubx__.logger.error("calc nbids - bidderRequests.bid.getFloor().floor is undefined",e.code)}else window.__pubx__.logger.error("calc nbids - bidderRequests.bid.getFloor doesn't exist",e.code)})).filter(e=>void 0!==e);0!==T.length?f=T.reduce((e,o)=>e+o,0)/T.length:(0===t.length||(N({code:s.ErrorCode.GET_FLOOR_NOT_FOUND,adUnitCode:e.code}),window.__pubx__.logger.error("calc nbids - None of bidderRequests.bids.getFloor() is defined",e.code)),void 0!==n.defaultValues["*|banner"]?f=n.defaultValues["*|banner"]:(N({code:s.ErrorCode.TAG_DEFAULT_VALUES_NOT_FOUND,adUnitCode:e.code}),window.__pubx__.logger.error("defaultValues of *|banner in config is undefined",e.code),f=.01)),l=f}return b({type:"pbBid",data:{adUnitCode:e.code,status:i,bidCurrency:u,bidValue:parseFloat(l.toFixed(4)),pubCurrency:n.currency,floorData:A(O),adserverTargeting:c}}),i===d.FLOORED&&(l=m(l,u,n.currency,e.code,N,_)),parseFloat(l.toFixed(4))},F=e=>{let o=e.flatMap(e=>e.bids.map(({floorData:e})=>{if(e&&e.floorProvider===u&&e.modelVersion)return e.modelVersion})).filter(e=>void 0!==e)[0];return o},T=e=>{let o=e.includes("_AB_")?e.split("_AB_")[1].split("_")[0]:void 0;return o},C=(e,o,r)=>{switch(r){case d.WIN:return e.includes("_dwt_")?parseFloat(e.split("_dwt_")[1].split("_")[0]):o.winBidMultiplier;case d.FLOORED:return e.includes("_dt_")?parseFloat(e.split("_dt_")[1].split("_")[0]):o.flooredBidMultiplier;case d.NOBIDS:return e.includes("_dnt_")?parseFloat(e.split("_dnt_")[1].split("_")[0]):o.noBidMultiplier}},y=(e,o,r)=>{let{error:t}=window.__pubx__.logger;if(e.includes("_fm_"))return parseFloat(e.split("_fm_")[1].split("_")[0]);if(r({code:s.ErrorCode.PMAC_FLOOR_MULTIPLIER_NOT_FOUND,payload:{modelVersion:e}}),t(s.errorDict[s.ErrorCode.PMAC_FLOOR_MULTIPLIER_NOT_FOUND].message,{modelVersion:e}),!o.pmacFloorMultiplier)throw r({code:s.ErrorCode.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG}),t(s.errorDict[s.ErrorCode.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG].message,{modelVersion:e}),Error("pmacFloorMultiplier is not set in config");return o.pmacFloorMultiplier},w=(e,o,r)=>{let t=void 0!==e.mediaTypes.banner,i=e.bids.some(e=>!!e.bidder),n=(0,s.arePubxFloorsSet)(e);if(!o&&n)throw r({code:s.ErrorCode.PUBX_OFF_FLOORS_FOUND,adUnitCode:e.code}),Error("pubxLoaded is false but has floorData for adUnitCode "+e.code);return t&&i&&(!o&&!n||o&&n)},v=e=>e?e.filter(e=>!!e.originalCpm):[],S=(e,o,r,t,i,n)=>{let{remoteAucError:d}=i;return o.adUnits.filter(o=>w(o,e,d)&&(0,s.arePubxFloorsSet)(o)).map(e=>{let a=N(o.bidsReceived,e.code),_=b(v(o.bidsRejected),e.code),l=E(o.bidderRequests,e.code),u=R(a,_,t.hbPbKey);if(void 0===r)throw d({code:s.ErrorCode.MODEL_VERSION_NOT_FOUND_READ,adUnitCode:e.code}),Error("floorModelVersion is undefined but adUnit.bids is not");let O=I(e,a,_,l,u,t,i,n);try{(0,s.triggerPmac)(o.auctionId,e.code,O,u,t,y(r,t,d),i)}catch(e){window.__pubx__.logger.error("Error in Pmac",e)}e.code;let c=parseFloat((O*C(r,t,u)).toFixed(4));return(0,s.arePubxFloorsSkipped)(e)?void 0:{adUnitCode:e.code,floorValue:c,status:u}}).filter(e=>void 0!==e)},D=()=>(()=>({flooredBidMultiplier:0.75,noBidMultiplier:0.1,winBidMultiplier:1.0,pmacFloorMultiplier:0.5,gamBuckets:[{'pbx_a0d_n':[0,0.03]},{'pbx_a1d_n':[0.03,0.06]},{'pbx_a2d_n':[0.06,0.09]},{'pbx_a3d_n':[0.09,0.12]},{'pbx_a4d_n':[0.12,0.15]},{'pbx_b0d_n':[0.15,0.2]},{'pbx_b1d_n':[0.2,0.25]},{'pbx_b2d_n':[0.25,0.3]},{'pbx_b3d_n':[0.3,0.35]},{'pbx_b4d_n':[0.35,0.4]},{'pbx_b5d_n':[0.4,0.45]},{'pbx_b6d_n':[0.45,0.5]},{'pbx_b7d_n':[0.5,0.55]},{'pbx_b8d_n':[0.55,0.6]},{'pbx_b9d_n':[0.6,0.65]},{'pbx_b10d_n':[0.65,0.7]},{'pbx_b11d_n':[0.7,0.75]},{'pbx_b12d_n':[0.75,0.8]},{'pbx_b13d_n':[0.8,0.85]},{'pbx_b14d_n':[0.85,0.9]},{'pbx_b15d_n':[0.9,0.95]},{'pbx_b16d_n':[0.95,1]},{'pbx_c0d_n':[1,1.1]},{'pbx_c1d_n':[1.1,1.2]},{'pbx_c2d_n':[1.2,1.3]},{'pbx_c3d_n':[1.3,1.4]},{'pbx_c4d_n':[1.4,1.5]},{'pbx_c5d_n':[1.5,1.6]},{'pbx_c6d_n':[1.6,1.7]},{'pbx_c7d_n':[1.7,1.8]},{'pbx_c8d_n':[1.8,1.9]},{'pbx_c9d_n':[1.9,2]},{'pbx_d0d_n':[2,2.25]},{'pbx_d1d_n':[2.25,2.5]},{'pbx_d2d_n':[2.5,2.75]},{'pbx_d3d_n':[2.75,3]},{'pbx_d4d_n':[3,3.25]},{'pbx_d5d_n':[3.25,3.5]},{'pbx_d6d_n':[3.5,3.75]},{'pbx_d7d_n':[3.75,4]},{'pbx_d8d_n':[4,4.25]},{'pbx_d9d_n':[4.25,4.5]},{'pbx_d10d_n':[4.5,4.75]},{'pbx_d11d_n':[4.75,5]},{'pbx_d12d_n':[5,111111]}]}))(),L=()=>{window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[]},x=(e,o)=>{let r=googletag.pubads().getSlots(),t=[];return e.forEach(e=>{let i=r.find(o=>o.getAdUnitPath()===e||o.getSlotElementId()===e);void 0===i?(window.__pubx__.logger.error("GPT Slot not found for adUnitCode",e),o({code:s.ErrorCode.GPT_SLOT_NOT_FOUND,adUnitCode:e})):t.push({adUnitCode:e,slot:i})}),t},P=(e,o)=>{if(0===e)return o[0];let r=o.find(o=>{let r=Object.keys(o)[0],[t,i]=o[r];return e>t&&e<=i});return r},M=(e,o,r)=>{let t=P(e.floorValue,o.gamBuckets);if(void 0===t)throw r({code:s.ErrorCode.GAM_BUCKET_NOT_FOUND,adUnitCode:e.adUnitCode,payload:{floorWithStatus:e}}),Error("GAM Bucket not found for floorValue "+JSON.stringify(e));let i=Object.keys(t)[0],n=e.status===d.WIN?"_w":e.status===d.FLOORED?"_f":"_n";return i.split("_n")[0]+n};var h=function(e,o,r,t){return new(r||(r=Promise))(function(i,n){function d(e){try{_(t.next(e))}catch(e){n(e)}}function a(e){try{_(t.throw(e))}catch(e){n(e)}}function _(e){var o;e.done?i(e.value):((o=e.value)instanceof r?o:new r(function(e){e(o)})).then(d,a)}_((t=t.apply(e,o||[])).next())})},G=function(e,o){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&0>o.indexOf(t)&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,t=Object.getOwnPropertySymbols(e);i<t.length;i++)0>o.indexOf(t[i])&&Object.prototype.propertyIsEnumerable.call(e,t[i])&&(r[t[i]]=e[t[i]]);return r};let V="https://analytics.pbxai.com",B=V+"/errors",j=V+"/events";(t=a||(a={})).PB_GENERIC="PB_GENERIC",t.PB_GAM_GENERIC="PB_GAM_GENERIC",t.PB_GAM_GLOBAL_KVS="PB_GAM_GLOBAL_KVS",t.PB_GAM_CUSTOM_SNIGEL="PB_GAM_CUSTOM_SNIGEL",t.PB_GAM_CUSTOM_INVESTING="PB_GAM_CUSTOM_INVESTING",t.PB_GAM_CUSTOM_INVESTING_FLOORSCONFIG="PB_GAM_CUSTOM_INVESTING_FLOORSCONFIG",t.PB_GAM_CUSTOM_IMPROVEMEDIA="PB_GAM_CUSTOM_IMPROVEMEDIA",t.PB_GAM_CUSTOM_DAILYMOTION="PB_GAM_CUSTOM_DAILYMOTION",t.PB_GAM_CUSTOM_AY="PB_GAM_CUSTOM_AY",t.PB_GAM_CUSTOM_LIVEWRAPPED="PB_GAM_CUSTOM_LIVEWRAPPED",(i=_||(_={})).GPT_SLOT_NOT_FOUND="GPT_SLOT_NOT_FOUND",i.GAM_BUCKET_NOT_FOUND="GAM_BUCKET_NOT_FOUND",i.CALC_FLOOR_NOT_FOUND="CALC_FLOOR_NOT_FOUND",i.MODEL_VERSION_NOT_FOUND_WRITE="MODEL_VERSION_NOT_FOUND_WRITE",i.IMPROVEMEDIA_API_NOT_FOUND="IMPROVEMEDIA_API_NOT_FOUND",i.INVESTING_FILTER_NOT_FOUND="INVESTING_FILTER_NOT_FOUND",i.PUBX_AA_NOT_FOUND="PUBX_AA_NOT_FOUND",i.PRICE_FLOORS_NOT_FOUND="PRICE_FLOORS_NOT_FOUND",i.NON_PUBX_FLOORS_FOUND="NON_PUBX_FLOORS_FOUND",i.CURRENCY_INVALID_INPUT="CURRENCY_INVALID_INPUT",i.CURRENCY_MODULE_NOT_INSTALLED="CURRENCY_MODULE_NOT_INSTALLED",i.ADUNIT_SIZES_NOT_FOUND="ADUNIT_SIZES_NOT_FOUND",i.GET_FLOOR_NOT_FOUND="GET_FLOOR_NOT_FOUND",i.TAG_DEFAULT_VALUES_NOT_FOUND="TAG_DEFAULT_VALUES_NOT_FOUND",i.PUBX_OFF_FLOORS_FOUND="PUBX_OFF_FLOORS_FOUND",i.MODEL_VERSION_NOT_FOUND_READ="MODEL_VERSION_NOT_FOUND_READ",i.PMAC_FLOOR_MULTIPLIER_NOT_FOUND="PMAC_FLOOR_MULTIPLIER_NOT_FOUND",i.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG="PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG",i.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE="INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE",i.MISSING_ADUNIT_FLOOR_RESPONSE="MISSING_ADUNIT_FLOOR_RESPONSE",i.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE="PMAC_FLOOR_RESPONSE_NOT_AVAILABLE",i.UNCAUGHT_ERROR="UNCAUGHT_ERROR",i.UNCAUGHT_GAM_ERROR="UNCAUGHT_GAM_ERROR",(n=l||(l={})).INFO="INFO",n.WARNING="WARNING",n.ERROR="ERROR",n.FATAL="FATAL";let k={[_.GPT_SLOT_NOT_FOUND]:{message:"GPT Slot not found",severity:l.WARNING},[_.GAM_BUCKET_NOT_FOUND]:{message:"GAM Bucket not found",severity:l.WARNING},[_.CALC_FLOOR_NOT_FOUND]:{message:"floorWithStatus not found",severity:l.FATAL},[_.MODEL_VERSION_NOT_FOUND_WRITE]:{message:"floorModelVersion is undefined but floorsWithStatus is not",severity:l.FATAL},[_.IMPROVEMEDIA_API_NOT_FOUND]:{message:"lwhbim.adServerKeywordsAdUnit is not defined",severity:l.ERROR},[_.INVESTING_FILTER_NOT_FOUND]:{message:"window._imhb_auctions is not defined",severity:l.ERROR},[_.PUBX_AA_NOT_FOUND]:{message:"pubxaiAnalyticsAdapter module is not installed",severity:l.WARNING},[_.PRICE_FLOORS_NOT_FOUND]:{message:"priceFloors module is not installed",severity:l.WARNING},[_.NON_PUBX_FLOORS_FOUND]:{message:"Non-pubx floor provider present",severity:l.WARNING},[_.CURRENCY_INVALID_INPUT]:{message:"Invalid input types for currency conversion",severity:l.WARNING},[_.CURRENCY_MODULE_NOT_INSTALLED]:{message:"currency module of prebid.js is not installed",severity:l.WARNING},[_.ADUNIT_SIZES_NOT_FOUND]:{message:"sizes in adUnit is undefined",severity:l.WARNING},[_.GET_FLOOR_NOT_FOUND]:{message:"calc nbids - None of bidderRequests.bids.getFloor() is defined",severity:l.WARNING},[_.TAG_DEFAULT_VALUES_NOT_FOUND]:{message:"defaultValues of *|banner in config is undefined",severity:l.ERROR},[_.PUBX_OFF_FLOORS_FOUND]:{message:"pubxLoaded is false but has floorData",severity:l.FATAL},[_.MODEL_VERSION_NOT_FOUND_READ]:{message:"floorModelVersion is undefined but adUnit.bids is not",severity:l.FATAL},[_.PMAC_FLOOR_MULTIPLIER_NOT_FOUND]:{message:"PMAC floor multiplier not found in floors-response",severity:l.ERROR},[_.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG]:{message:"PMAC floor multiplier not found in config",severity:l.ERROR},[_.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE]:{message:"Invalid schema fields in floor rules response, expected only ['gptSlot']",severity:l.ERROR},[_.MISSING_ADUNIT_FLOOR_RESPONSE]:{message:"adUnitCode not found in floor rules response",severity:l.ERROR},[_.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE]:{message:"Floors Reponse not available for pmac",severity:l.WARNING},[_.UNCAUGHT_ERROR]:{message:"Uncaught Error",severity:l.ERROR},[_.UNCAUGHT_GAM_ERROR]:{message:"Uncaught GAM Error",severity:l.ERROR}},W=e=>{let{__pubx__:{variant:o,version:r}}=window;return{variant:o,version:r,loadTime:window.__loadTime__,pbVersion:e.version,pbNamespace:e.name}},K=e=>({userAgent:navigator.userAgent,host:window.location.host,path:window.location.pathname,pageId:e,doNotTrack:navigator.doNotTrack}),q=(e,o)=>e.getEvents().filter(e=>"auctionEnd"===e.eventType).findIndex(e=>e.args.auctionId===o),z=e=>e.getEvents().filter(e=>"auctionInit"===e.eventType).length,H=e=>JSON.parse(JSON.stringify(e)),Y=e=>{let{code:o,adUnitCode:r,payload:t}=e,{message:i,severity:n}=k[o];return{code:o,severity:n,message:i,adUnitCode:r,payload:t}},X=(e,o,r,t,i)=>{let n=H(o);if(e.adUnitCode){let{adUnits:o,bidderRequests:r,bidsReceived:t,bidsRejected:i}=n;n=Object.assign(Object.assign({},n),{adUnits:o.filter(o=>o.code===e.adUnitCode),bidderRequests:r.map(o=>Object.assign(Object.assign({},o),{bids:o.bids.filter(o=>o.adUnitCode===e.adUnitCode)})),bidsReceived:t.filter(o=>o.adUnitCode===e.adUnitCode),bidsRejected:i?i.filter(o=>o.adUnitCode===e.adUnitCode):void 0})}let{auctionId:d,adUnits:a,bidderRequests:_,bidsReceived:l,bidsRejected:s}=n,u={adUnits:a.map(({code:e,sizes:o,bids:r,mediaTypes:t})=>({code:e,mediaTypes:Object.keys(t)})),bidderRequestsCount:_.length,bidsReceived:l.map(({adUnitCode:e,adserverTargeting:o,cpm:r,currency:t,originalCpm:i,originalCurrency:n,floorData:d})=>({adUnitCode:e,adserverTargeting:o?{hb_pb:o.hb_pb}:void 0,cpm:r,currency:t,originalCpm:i,originalCurrency:n,floorData:d?{floorValue:d.floorValue}:void 0})),bidsRejected:s?s.map(({adUnitCode:e,adserverTargeting:o,cpm:r,currency:t,originalCpm:i,originalCurrency:n,floorData:d})=>({adUnitCode:e,adserverTargeting:o?{hb_pb:o.hb_pb}:void 0,cpm:r,currency:t,originalCpm:i,originalCurrency:n,floorData:d?{floorValue:d.floorValue}:void 0})):void 0};return Object.assign({previousAuctionCount:q(i,d),auctionId:d,auctionInfo:u,modelVersion:F(_)},J(e,r,t,i))},J=(e,o,r,t)=>({isPubxEnabled:window.__pubxLoaded__,pubxId:o.pubxId,tagInfo:W(t),pageInfo:K(r),errorData:Y(e),timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now()}),Z=e=>{let o=e.getConfig("floors");return o&&o.data&&o.data.floorProvider?o.data.floorProvider:void 0},Q=(e,o,r,t,i)=>{let{auctionId:n,adUnits:d,bidsReceived:a,bidsRejected:_,bidderRequests:l}=e,s={adUnitCount:d.length,bidCount:a.length+(_?_.length:0),bidders:[...new Set(l.map(({bidderCode:e})=>e))]};return{isPubxEnabled:window.__pubxLoaded__,pubxId:o.pubxId,loadedBeforePb:window.__loadedBeforePb__,tagInfo:W(i),floorProvider:Z(i),pageInfo:K(t),missedAuctionCount:r,timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now(),previousAuctionCount:q(i,n),auctionId:n,auctionInfo:s,modelVersion:F(l),pbBidData:[],gamTargetingData:[]}},$=e=>{let{severity:o}=k[e.code];return!1},ee=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let o=16*Math.random()|0;return("x"===e?o:3&o|8).toString(16)}),eo=(e,o)=>{let r=[],t=[],i=[],n=z(o),d=ee(),a=1/e.samplingRate>Math.random();window.__pubxLogsEnabled__=a;let _=(e,o)=>{if(0===e.length)return;JSON.parse(JSON.stringify(e));let r=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(o,r),e.splice(0)},l=e=>{if(0===e.length)return 0;let o=new Blob([JSON.stringify(e)]);return o.size},s=()=>!!navigator.sendBeacon&&!!document.visibilityState;s()&&document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(_(r,B),_(t,B),_(i,j))});let u=window.location.search,O=new URLSearchParams(u);return{debug:(e,...o)=>{O.has("pubx_debug")&&console.info("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","INFO:",e,...o)},error:(...e)=>{O.has("pubx_debug")&&console.error("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","ERROR:",...e)},makeRemoteAucError:t=>{let i=H(t),n=(r,t)=>{t.push(X(r,i,e,d,o)),H(t)};return e=>{if(s()&&(a||$(e))){let o=H(r);n(e,o),l(o)>65536?(_(r,B),n(e,r)):r=o}}},remotePageError:r=>{if(s()&&(a||$(r))){let i=(r,t)=>{t.push(J(r,e,d,o))},n=H(t);i(r,n),l(n)>65536?(_(t,B),i(r,t)):t=n}},makeRemoteAucEvent:r=>{let t=H(r),u=(r,i)=>{let a=i.find(e=>e.auctionId===t.auctionId);if(void 0===a&&(a=Q(t,e,n,d,o),i.push(a)),"pbBid"===r.type)a.pbBidData.push(r.data);else if("gamTargeting"===r.type){let e=r.data,o=a.gamTargetingData.find(o=>o.adUnitCode===e.adUnitCode);void 0===o?a.gamTargetingData.push(e):Object.assign(o,e)}H(i)};return e=>{if(s()&&a){let o=H(i);u(e,o),l(o)>65536?(_(i,j),u(e,i)):i=o}}}}},er=e=>{window.__pubx__.logger.debug("version:",window.__pubx__.variant+"_"+window.__pubx__.version+"_"+e.name)},et=()=>{window.__loadTime__=window.__loadTimestamp__?Date.now()-window.__loadTimestamp__:-1,window.__loadTimestamp__=Date.now()},ei=(e,o)=>{let r=window.__pubxFloorsConfig__.floors,{auctionDelay:t,endpoint:i,data:n}=r,d=G(r,["auctionDelay","endpoint","data"]);window.__nextfloorsConfig__={floors:Object.assign(Object.assign({},d),{data:e})}},en=e=>window.__pmacCpmHistory__[e],ed=e=>{let o=en(e);return o?o.history:[]},ea=(e,o,r,t)=>{let{debug:i}=window.__pubx__.logger,{__pmacCpmHistory__:n}=window;void 0===n[o]&&(n[o]={history:[],decayRate:void 0});let d={auctionId:e,cpm:r,adUnitStatus:t};ed(o).push(d),i("Update Pmac history",o,d)},e_=(e,o,r)=>Math.log(o/(e=0===e?.01:e))/r,el=(e,o,r)=>(e=0===e?.01:e)*Math.exp(o*r),es=e=>{let{debug:o}=window.__pubx__.logger,r=en(e),{history:t}=r,[i,n,d]=[t[0].cpm,t[t.length-1].cpm,t.length-1];r.decayRate=e_(i,n,d),o("Update decay rate",e,r.decayRate)},eu=e=>{let o=ed(e);if(0===o.length)return!1;if(1===o.length)return!0;let r=o.slice(0,-1).map(e=>e.cpm).reduce((e,o)=>Math.min(e,o)),t=o[o.length-1].cpm;return t<r},eO=(e,o)=>{let{remoteAucError:r}=o,{__pmacCpmHistory__:t}=window,i=Object.keys(t);if(window.__pubx__.variant===a.PB_GAM_CUSTOM_AY)i.forEach(r=>{eu(r)&&ef(r,void 0,eN(r,e),o)});else{let t=x(i,r);t.forEach(({adUnitCode:r,slot:t})=>{eu(r)&&ef(r,t,eN(r,e),o)})}},ec=(e,o)=>{let r=Object.keys(o),t=r.find(o=>[e.getAdUnitPath()+"|banner|*",e.getSlotElementId()+"|banner|*"].includes(o));return t},ep=(e,o)=>{let r=Object.keys(o),t=r.find(o=>o.split("|banner|*")[0]===eS(e));return t},ef=(e,o,r,t)=>{let i;let{remoteAucError:n}=t,{error:d}=window.__pubx__.logger,{__nextfloorsConfig__:l}=window;if(void 0===l)throw Error("__nextfloorsConfig__ undefined. Skip updating adUnit floors config");let{floors:{data:{values:s}}}=l;if(void 0===(i=window.__pubx__.variant===a.PB_GAM_CUSTOM_AY?ep(e,s):ec(o,s))){n({code:_.MISSING_ADUNIT_FLOOR_RESPONSE,adUnitCode:e}),d(k[_.MISSING_ADUNIT_FLOOR_RESPONSE].message,{adUnitCode:e});return}s[i]=r},eg=e=>ed(e).length<=1,eN=(e,o)=>{let{decayRate:r,history:t}=en(e),[i,n,a]=[t[0].cpm,t.length,t[t.length-1]];if(eg(e)||a.adUnitStatus===d.NOBIDS)return.01;let _=el(i,r,n),l=_*o;return l<.01?.01:parseFloat(l.toFixed(4))},eb=(e,o)=>h(void 0,void 0,void 0,function*(){let{debug:o}=window.__pubx__.logger,r=yield fetch(e.floorFetchUrl),t=yield r.json();o("Received floor rules",t),ei(t,e)}),eE=(e=null,(o,r,t,i,n,d,l)=>h(void 0,void 0,void 0,function*(){let{remoteAucError:s}=l,{error:u}=window.__pubx__.logger;null===e&&(e=eb(n,l)),yield e,ea(o,r,t,i),eg(r)||es(r);let{__nextfloorsConfig__:O,__pubxLoaded__:c}=window;if(void 0===O)throw s({code:_.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE,adUnitCode:r}),u(k[_.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE].message,{adUnitCode:r}),Error("__nextfloorsConfig__ undefined. Skip updating floors config");window.__pubx__.variant===a.PB_GAM_CUSTOM_AY?(eO(d,l),f(c,n,e=>O)):googletag.cmd.push(()=>{try{eO(d,l),f(c,n,e=>O)}catch(e){u(e),l.remoteAucError({code:_.UNCAUGHT_GAM_ERROR,payload:{name:e.name,message:e.message}})}})})),eR=(e,o)=>{window.__pubxFloors__={},window.__pubxLoaded__=em(e.splitRate),window.__loadedBeforePb__=e.pbNamespaces.every(e=>void 0===e.version),window.__pmacCpmHistory__={},et(),window.__pubx__={variant:o,version:"1711611924913"},e.pbNamespaces.forEach(o=>{o.que.push(function(){window.__pubx__.logger=eo(e,o),er(o)})})},em=e=>void 0!==window.__pubxLoaded__?window.__pubxLoaded__:e>100*Math.random(),eU=e=>e.bids.some(({floorData:e})=>e&&e.floorProvider===u&&e.skipped),eA=e=>e.bids.some(({floorData:e})=>e&&e.floorProvider===u&&e.modelVersion),eI=(e,o,r)=>{if("object"!=typeof e||0===o.length){window.__pubx__.logger.error("setObjectValueFromKeyPath: invalid arguments",{object:e,keyPath:o,value:r});return}let t=o.length-1;for(let r=0;r<t;++r){let t=o[r];t in e||(e[t]={}),e=e[t]}e[o[t]]=r},eF=(e,o)=>e+"-"+o,eT=(e,o)=>{let r=eU(e);return r?o.pubxOptimizedOffValue:o.pubxOptimizedOnValue},eC=(e,o)=>{let r=eA(e);return r?o.pubxSplitOnValue:o.pubxSplitOffValue},ey=(e,o,r,t,i)=>{let{remoteAucEvent:n}=i;eI(window.__pubxFloors__,[e,o,r],t),window.__pubx__.logger.debug("Setting KVs in Global",{auctionId:e,adUnitCode:o,key:r,value:t}),n({type:"gamTargeting",data:{adUnitCode:o,[r]:t}})},ew=(e,o,r,t)=>{let{remoteAucError:i,remoteAucEvent:n}=t,{auctionId:d,adUnits:a}=r;a.filter(o=>w(o,e,i)).forEach(e=>{let r=eC(e,o);if(ey(d,e.code,o.pubxSplitKey,r,t),r===o.pubxSplitOnValue){let r=eT(e,o);ey(d,e.code,o.pubxOptimizedKey,r,t)}})},ev=(e,o,r,t,i)=>{let{remoteAucError:n}=i;e.forEach(e=>{let{adUnitCode:d}=e,a=M(e,t,n);if(ey(r,d,t.pubxFloorKey,a,i),void 0===o)throw n({code:_.MODEL_VERSION_NOT_FOUND_WRITE,adUnitCode:d,payload:{floorWithStatus:e}}),Error("floorModelVersion is undefined but floorsWithStatus is not");let l=T(o);if(l){ey(r,d,t.pubxMvKey,l,i);let e=eF(a,l);ey(r,d,t.pubxFloorMvKey,e,i)}})},eS=e=>e.split("__ayManagerEnv__")[0],eD=(()=>{let e=O();c(e);let o=D();return L(),Object.assign(Object.assign({},e),o)})();(0,s.initPubxGlobals)(eD,s.Template.PB_GAM_GLOBAL_KVS);let eL=window.__pubxLoaded__;(e=>{e.pbNamespaces.forEach(o=>{o.que.push(function(){let{debug:r,error:t,remotePageError:i}=window.__pubx__.logger;if(!o.installedModules.includes("pubxaiAnalyticsAdapter")){t("pubxaiAnalyticsAdapter module is not installed"),i({code:s.ErrorCode.PUBX_AA_NOT_FOUND});return}let n=p(e);o.enableAnalytics(n),r("Enabling Analytics",n)})})})(eD),f(eL,eD,e=>{let o={floors:{enforcement:{floorDeals:!0},auctionDelay:e.auctionDelay,endpoint:{url:e.floorFetchUrl},data:{floorProvider:u,modelVersion:e.modelVersion,currency:e.currency,schema:{fields:e.schema},values:e.defaultValues}}};return e.floorMin&&(o.floors.floorMin=e.floorMin),o}),((e,o,r,t,i)=>{o.pbNamespaces.forEach(n=>{n.que.push(function(){n.onEvent("auctionEnd",d=>{try{let{makeRemoteAucError:a,makeRemoteAucEvent:_,error:l}=window.__pubx__.logger,u={remoteAucError:a(d),remoteAucEvent:_(d)};try{i&&(d=i(d,u)),r(e,o,d,u);let a=F(d.bidderRequests),_=S(e,d,a,o,u,n);t(_,a,d.auctionId,o,u)}catch(e){l(e),u.remoteAucError({code:s.ErrorCode.UNCAUGHT_ERROR,payload:{name:e.name,message:e.message}})}}catch(e){window.__pubx__.logger.error(e)}})})})})(eL,eD,s.setSplitKeyGlobal,s.setFloorsAndMvInGlobal)})();